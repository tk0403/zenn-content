---
title: "TiDBã§PDã®æƒ…å ±ã‚’è¦‹ã‚‹ï¼špd-ctl"
emoji: "ğŸ“˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["TiDB"]
published: false
---

# ã¯ã˜ã‚ã«
ã“ã®Docsã«åŸºã¥ãã¾ã™
https://docs.pingcap.com/ja/tidb/stable/pd-control

## å‰æï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
### tiup playgroundèµ·å‹•ã¨ç¢ºèª
tiup playgroundã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚
```
tiup playground v7.5.0 --db 2 --kv 3 --pd 3
```

### pd-ctlã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

## PDæƒ…å ±ã®ç¢ºèª
ä»¥ä¸‹ã§ã¤ãªãã¾ã™ã€‚
```
tiup ctl:v7.5.0 pd store -u http://127.0.0.1:2379
```

ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ä»¥ä¸‹ã§ã™ã€‚
```
tiup ctl:v7.5.0 pd -i -u http://127.0.0.1:2379
```
ä»¥ä¸‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã§ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚
PD Leaderã‚’ç¢ºèªã—ã¾ã™ã€‚
```
member leader show
```
çµæœ
```
{
  "name": "pd-2",
  "member_id": 4060626905997471512,
  "peer_urls": [
    "http://127.0.0.1:2383"
  ],
  "client_urls": [
    "http://127.0.0.1:2384"
  ]
}
```
Followerå«ã‚ãŸãƒãƒ¼ãƒ‰ã®ç¢ºèª
```
member list
```

```
{
  "header": {
    "cluster_id": 7314519920545438215
  },
  "members": [
    {
      "name": "pd-1",
      "member_id": 2234275743217008298,
      "peer_urls": [
        "http://127.0.0.1:2381"
      ],
      "client_urls": [
        "http://127.0.0.1:2382"
      ],
      "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
      "binary_version": "v7.5.0",
      "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
    },
    {
      "name": "pd-0",
      "member_id": 3474484975246189105,
      "peer_urls": [
        "http://127.0.0.1:2380"
      ],
      "client_urls": [
        "http://127.0.0.1:2379"
      ],
      "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
      "binary_version": "v7.5.0",
      "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
    },
    {
      "name": "pd-2",
      "member_id": 4060626905997471512,
      "peer_urls": [
        "http://127.0.0.1:2383"
      ],
      "client_urls": [
        "http://127.0.0.1:2384"
      ],
      "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
      "binary_version": "v7.5.0",
      "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
    }
  ],
  "leader": {
    "name": "pd-2",
    "member_id": 4060626905997471512,
    "peer_urls": [
      "http://127.0.0.1:2383"
    ],
    "client_urls": [
      "http://127.0.0.1:2384"
    ],
    "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
    "binary_version": "v7.5.0",
    "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
  },
  "etcd_leader": {
    "name": "pd-2",
    "member_id": 4060626905997471512,
    "peer_urls": [
      "http://127.0.0.1:2383"
    ],
    "client_urls": [
      "http://127.0.0.1:2384"
    ],
    "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
    "binary_version": "v7.5.0",
    "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
  }
}
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§PDã®Pidã‚’ç¢ºèªã—ã¾ã™ã€‚
```
tiup playground display
```

```
Pid    Role     Uptime
---    ----     ------
90168  pd       1h33m42.046633959s
90169  pd       1h33m42.028443375s
90170  pd       1h33m42.012332916s
90171  tikv     1h33m41.992939041s
90172  tikv     1h33m41.973151625s
90173  tikv     1h33m41.955047625s
90174  tidb     1h33m41.934162541s
90175  tidb     1h33m41.913525291s
90236  tiflash  1h33m21.120791459s
```

åŒã˜ãã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§killã™ã‚‹PDï¼ˆã®ãƒ—ãƒ­ã‚»ã‚¹ï¼‰ã‚’ç¢ºèªã—ã¾ã™ã€‚
```
ps auxh | grep -e '90170' -e '90169' -e '90168'
```

```
tkusaka          90170   2.5  0.8 418943200 132752 s009  S+   12:52PM   2:53.46 /Users/tkusaka/.tiup/components/pd/v7.5.0/pd-server --name=pd-2 --data-dir=/Users/tkusaka/.tiup/data/TywqeaH/pd-2/data --peer-urls=http://127.0.0.1:2383 --advertise-peer-urls=http://127.0.0.1:2383 --client-urls=http://127.0.0.1:2384 --advertise-client-urls=http://127.0.0.1:2384 --log-file=/Users/tkusaka/.tiup/data/TywqeaH/pd-2/pd.log --initial-cluster=pd-0=http://127.0.0.1:2380,pd-1=http://127.0.0.1:2381,pd-2=http://127.0.0.1:2383
tkusaka          90169   0.7  0.4 420065152  70336 s009  S+   12:52PM   0:39.32 /Users/tkusaka/.tiup/components/pd/v7.5.0/pd-server --name=pd-1 --data-dir=/Users/tkusaka/.tiup/data/TywqeaH/pd-1/data --peer-urls=http://127.0.0.1:2381 --advertise-peer-urls=http://127.0.0.1:2381 --client-urls=http://127.0.0.1:2382 --advertise-client-urls=http://127.0.0.1:2382 --log-file=/Users/tkusaka/.tiup/data/TywqeaH/pd-1/pd.log --initial-cluster=pd-0=http://127.0.0.1:2380,pd-1=http://127.0.0.1:2381,pd-2=http://127.0.0.1:2383
tkusaka          90168   0.6  0.4 418940832  63920 s009  S+   12:52PM   0:38.46 /Users/tkusaka/.tiup/components/pd/v7.5.0/pd-server --name=pd-0 --data-dir=/Users/tkusaka/.tiup/data/TywqeaH/pd-0/data --peer-urls=http://127.0.0.1:2380 --advertise-peer-urls=http://127.0.0.1:2380 --client-urls=http://127.0.0.1:2379 --advertise-client-urls=http://127.0.0.1:2379 --log-file=/Users/tkusaka/.tiup/data/TywqeaH/pd-0/pd.log --initial-cluster=pd-0=http://127.0.0.1:2380,pd-1=http://127.0.0.1:2381,pd-2=http://127.0.0.1:2383
tkusaka          99116   0.0  0.0 408119968   1200 s017  S+    2:40PM   0:00.00 grep -e 90170 -e 90169 -e 90168
```
ä»¥ä¸Šã‹ã‚‰åˆ†ã‹ã‚‹ã“ã¨ã¨ã—ã¦ã€PDãƒãƒ¼ãƒ‰ï¼“å°ï¼ˆãƒ—ãƒ­ã‚»ã‚¹ã§ã™ãŒï¼‰ã®ã†ã¡ã€pd-2ï¼ˆ`peer_urls=http://127.0.0.1:2383`ã€`client_urls=http://127.0.0.1:2384`ã€`pid=90170`ï¼‰ãŒLeaderã®ã‚ˆã†ã§ã™ã€‚

## PDã‚’killã™ã‚‹
ãã‚Œã§ã¯PDã‚’killã—ã¾ã™ã€‚ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§PDãƒªãƒ¼ãƒ€ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®killã—ã¾ã™ã€‚
```
kill 90170
```

```
tkusaka          90168   1.0  0.7 418940960 113424 s009  S+   12:52PM   0:41.97 /Users/tkusaka/.tiup/components/pd/v7.5.0/pd-server --name=pd-0 --data-dir=/Users/tkusaka/.tiup/data/TywqeaH/pd-0/data --peer-urls=http://127.0.0.1:2380 --advertise-peer-urls=http://127.0.0.1:2380 --client-urls=http://127.0.0.1:2379 --advertise-client-urls=http://127.0.0.1:2379 --log-file=/Users/tkusaka/.tiup/data/TywqeaH/pd-0/pd.log --initial-cluster=pd-0=http://127.0.0.1:2380,pd-1=http://127.0.0.1:2381,pd-2=http://127.0.0.1:2383
tkusaka          90169   0.3  0.5 420065152  91552 s009  S+   12:52PM   0:42.52 /Users/tkusaka/.tiup/components/pd/v7.5.0/pd-server --name=pd-1 --data-dir=/Users/tkusaka/.tiup/data/TywqeaH/pd-1/data --peer-urls=http://127.0.0.1:2381 --advertise-peer-urls=http://127.0.0.1:2381 --client-urls=http://127.0.0.1:2382 --advertise-client-urls=http://127.0.0.1:2382 --log-file=/Users/tkusaka/.tiup/data/TywqeaH/pd-1/pd.log --initial-cluster=pd-0=http://127.0.0.1:2380,pd-1=http://127.0.0.1:2381,pd-2=http://127.0.0.1:2383
tkusaka          99756   0.0  0.0 408111776   1168 s017  S+    2:48PM   0:00.00 grep -e 90170 -e 90169 -e 90168
```
killã—ãŸç›´å¾Œã«ã€PDã®æƒ…å ±ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
```
Â» member leader show
{
  "name": "pd-0",
  "member_id": 3474484975246189105,
  "peer_urls": [
    "http://127.0.0.1:2380"
  ],
  "client_urls": [
    "http://127.0.0.1:2379"
  ]
}

Â» member list
{
  "header": {
    "cluster_id": 7314519920545438215
  },
  "members": [
    {
      "name": "pd-1",
      "member_id": 2234275743217008298,
      "peer_urls": [
        "http://127.0.0.1:2381"
      ],
      "client_urls": [
        "http://127.0.0.1:2382"
      ],
      "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
      "binary_version": "v7.5.0",
      "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
    },
    {
      "name": "pd-0",
      "member_id": 3474484975246189105,
      "peer_urls": [
        "http://127.0.0.1:2380"
      ],
      "client_urls": [
        "http://127.0.0.1:2379"
      ],
      "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
      "binary_version": "v7.5.0",
      "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
    },
    {
      "name": "pd-2",
      "member_id": 4060626905997471512,
      "peer_urls": [
        "http://127.0.0.1:2383"
      ],
      "client_urls": [
        "http://127.0.0.1:2384"
      ],
      "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
      "binary_version": "v7.5.0",
      "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
    }
  ],
  "leader": {
    "name": "pd-0",
    "member_id": 3474484975246189105,
    "peer_urls": [
      "http://127.0.0.1:2380"
    ],
    "client_urls": [
      "http://127.0.0.1:2379"
    ],
    "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
    "binary_version": "v7.5.0",
    "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
  },
  "etcd_leader": {
    "name": "pd-0",
    "member_id": 3474484975246189105,
    "peer_urls": [
      "http://127.0.0.1:2380"
    ],
    "client_urls": [
      "http://127.0.0.1:2379"
    ],
    "deploy_path": "/Users/tkusaka/.tiup/components/pd/v7.5.0",
    "binary_version": "v7.5.0",
    "git_hash": "ef6ba8551e525a700546d6bdb7ad6766115209cc"
  }
}
```
ãƒªãƒ¼ãƒ€ãƒ¼ãŒ`pd-2`ã‹ã‚‰`pd-0`ã«å¤‰ã‚ã‚Šã¾ã—ãŸã€‚